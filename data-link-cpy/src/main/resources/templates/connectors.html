<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="layout/layoutUser :: head"></head>
<body>
	<header th:replace="layout/layoutUser :: header"></header>

	<div class="container-fluid row">
		<div th:replace="layout/layoutUser :: sidebar"></div>
		<div class="col-10 card border-primary text-center">
			<div class="card-header">Connectors</div>
			<div class="card-body">


				<div class="card-title row">
					<select class="form-control col-6 mr-3" id="connCombo">
						<option value="0">Select..</option>
						<option value="1">InfusionSoft</option>
						<option value="2">ConnectWise</option>
					</select>
					<button class="btn btn-primary btn-xs col-3"
						onclick="modalHandler.showModal();">New Connector</button>
				</div>
			</div>
			<h4 class="card-title text-left">Connections:</h4>
			<div th:if="${not #lists.isEmpty(conns)}">

				<div class="container row">
					<div
						class="card text-justify shadow p-3 mb-5 bg-white rounded col-lg-4 col-sm-12"
						th:each="conn : ${conns}">

						<div class="card-body">
							<img th:src="@{/images/logos/ConnectWiseManage.png}"
								alt="ConnectWise" class="img-thumbnail float-left mr-3"
								style="width: 72px;">
							<h4 class="card-title" th:text="${conn.platform}"></h4>

							<p
								th:text="'Added: ' + ${#dates.format(conn.regDate,'MM/dd/yyyy')}"></p>
							<div class="row">
								<button class="btn btn-primary col-lg-5 mr-lg-1 mb-sm-1" onclick="modalHandler.testConn();"
									th:text="'Test'"></button>
								<button class="btn btn-danger col-lg-5 mb-sm-1"
									th:text="'Delete'"
									th:onclick="'alerts.confirm(\'/delete/conn/'+${conn.id}+'\',\'Do you really want to delete the connector for '+${conn.platform}+'?\',\'Yes, delete\');'"></button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div th:if="${#lists.isEmpty(conns)}">
				<h5>There are no connections saved</h5>
			</div>



			<div class="row">
				<nav th:replace="paginator-nav :: paginator"></nav>
			</div>


		</div>


	</div>


	<footer th:replace="layout/layoutUser :: footer"></footer>
	<script>
		var modalHandler = {
			showModal : function() {
				var app = $('#connCombo').val();
				var mensaje = '';
				if (app === '1') {
					mensaje = 'infusionSoftModal';
				} else if (app === '2') {
					mensaje = 'connectWiseModal';
				} else {
					alerts.show('You must select a platform', 'warning',
							'Understood');
				}
				if (mensaje !== '') {
					$('#' + mensaje).modal('show');
				}
			},
			testConn: function(){
				source: function(request,response){
					$.ajax({
						url: "/factura/cargar-productos/" + request.term,
						dataType: "json",
						data: {
							term: request.term
						},
						success: function(data){
							response($.map(data, function(item){
								return{
									value: item.id,
									label: item.nombre,
									precio: item.precio
								};
							}));
						},
					});
				}
			}
		};
	</script>
	
	<div th:replace="modals/modalConnectWise :: modalConnectWise"></div>
	<div th:replace="modals/modalInfusionSoft :: modalInfusionSoft"></div>
</body>
</html>